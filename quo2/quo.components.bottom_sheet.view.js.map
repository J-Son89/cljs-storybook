{"version":3,"sources":["quo/components/bottom_sheet/view.cljs"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,AAAA,AAAKA;AACL,AAAA,AAAKC;AACL,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKC;AAQL,AAAA,AAAMC,AACHC;AADH,AAEE,AAAAC,AAUM,AAACc,AAAUf;AAVjBC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAAOO;AAAP,AAAAH,AAAAJ,AAAA,AACOQ;AADP,AAAAJ,AAAAJ,AAAA,AAAA,AAEOS;AAFP,AAAAL,AAAAJ,AAAA,AAGOU;AAHP,AAAAN,AAAAJ,AAAA,AAAA,AAIOW;AAJP,AAAAP,AAAAJ,AAAA,AAAA,AAKOY;AALP,AAAAR,AAAAJ,AAAA,AAMOa;AAKDE,AAAS,AAACC;AACVC,AAAW,AAACD;AAEZE,AAAO,AAAA,AAACC;AAddd,AAe8B,AAACgB;AAf/BhB,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAJ,AAAA,AAAAI,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAAC,AAAAE,AAAAA;AAAA,AAAAD,AAAAC,AAAA,AAeOe;AAfPd,AAkBM,AAACkB;AAlBPlB,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAL,AAAA,AAAAK,AAAA,AAAA,AAAA,AAAA,AAAAJ,AAAAC,AAAAG,AAAAA;AAAA,AAAAF,AAAAE,AAAA,AAgBcgB;AAhBd,AAAAlB,AAAAE,AAAA,AAiBciB;AAERE,AACA,AAAA,AAAI,AAAA,AAAKC,AAAkBJ,AAAgB,AAAA,AAAGC;AAC9CI,AAAU,AAACC;AACXR,AAAc,AAAGA,AACA,AAAA,AAAIM,AACF,AAAA,AAAMD;AAKzBI,AAAW,AAAG,AAAA,AAAGC,AAA2B,AAAA,AAASH;AACrDI,AAAW,AAAGX,AAAc,AAAA,AAAMO;AAClCK,AAAQ,AAAA,AAACb;AAETc,AAAqB,AAAA,AAACC;AACtBC,AAAkB,AAACD,AAAmB,AAAA,AAAeE;AACrDC,AAAa,AAACH,AAAmB,AAAA,AAAeE;AAChDE,AAAU,AAAA,AAACJ;AACXK,AAAY,AAAA,AAACL;AACbM,AAAa,AAAA,AAACN;AACdO,AAAO,AAAA,AAACP;AACRQ,AAAU,AAAA,AAACR;AACXS,AAAM,AAACC;AACPC,AAAoB,AAAA,AAAA,AAACC,AAA6BR;AAClDS,AAAgB,AAAA,AAAA,AAAA,AAAA,AAACD,AACeb,AACAI,AACAF;AAChCa,AAAcD;AACdE,AAAa,AAAAC,AAAKnB;AAALoB,AACK,AAAA,AAAAC,AAAGC,AAAsBnC;AAD9B,AAAA,AAAAgC,AAAAC,AAAAD,AAAAC;;AAGbG,AAAgB,AAAA,AAACpB;AAnDvB,AAoDMqB;AACAC,AAAS;AAAA,AACE,AAAA,AAAAJ,AAAOpB;AAAP,AACE,AAAA,AAACyB,AAAOzB;;AACR,AAAA,AAACyB,AAAOvC;;AACR,AAAMX;AAAN,AACE,AAACA;;AADH;;;AAHF;;;AAKXmD,AAAY;AAAA,AACE,AAAA,AAACC,AAAmBnB;;AAClCoB,AAAQ,AAAKC;AAAL,AACE,AAAM,AAACC,AAAEP,AAAiB,AAAA,AAAMM;AAAhC,AACE,AAACL;;AADH;;;AAEVO,AAAY,AAACC,AAAc,AAACC,AAAY5B,AAAa,AAAA,AAAQD,AAClC,AAAC8B,AAAuBvB;AACnDwB,AAAY,AAACC,AACA;AAAA,AACE,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACC,AACiB,AAACC,AAAe,AAAA,AAACC,AAAoBtC,AACrB,AAAA,AAACuC,AAAgBvC,AACjBA,AAChBE,AACAM,AACAJ,AACAK,AACCY,AAAgBC;AAVtC;AAYZkB,AAAQ,AAACL,AACA;AAAA,AACE,AAACE,AACAhB,AACA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACoB,AACAP,AACe,AAACQ,AAAkBrB,AAAgB3D,AAEpC,AAAA,AAAQiF;AAR3B;AA9Ed,AAwFE,AAACC,AACA;AAAA,AACE,AAACP,AAAe,AAACN,AAAc,AAACC,AAAY5B,AAAa,AAAA,AAAMD,AAChC,AAAC0C,AAAcpC,AAC9B,AAAA,AAACqC,AAAgBZ,AAAaP;AAJjD,AAKEA;;AACF,AAACiB,AACA;AAAA,AACE,AAAA,AAACG,AACC,AAAA,AAACV,AAAe,AAACN,AAAcD,AAAYxB,AAC1B,AAAA,AAAC0C,AAAa1C,AACd,AAAC0C,AAAaxC,AAAOa,AACrB,AAAC4B,AAAoBvC,AACtC,AAAA,AAAC2B,AAAe,AAACN,AAAczB,AACA,AAACuC,AAActC,AAC7B,AAACyC,AAAaxC,AACA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAC0C,AAA4B1C,AACAa,AACAX,AACA9C,AAC3C,AAACyE,AAAe,AAACQ,AAAc,AAACZ,AAAuBvB,AACvC,AAAA,AAACsC,AAAa1C;AAfpD;;AAiBA,AAACsC,AACA;AAAA,AACE,AAAA,AAACG,AACC,AAAA,AAACV,AAAe,AAACN,AAAcD,AAAYvB,AAC1B,AAAA,AAACyC,AAAazC,AACd,AAACyC,AAAaxC,AAAOc,AACrB,AAAA,AAACwB,AAAkBvB,AACnB,AAAC0B,AAAoBvC,AACtC,AAAA,AAAC2B,AAAe,AAACL,AAAY3B,AAAU,AAAA,AAAMF,AAC5B,AAAA,AAACkC,AAAe,AAACN,AAAc,AAACc,AAActC,AAC7B,AAAC0C,AAAoBvC,AACrB,AAAA,AAACsC,AAAazC,AAC/B,AAACyC,AAAa3C,AAAU,AAAA,AAAeF,AACxD,AAAA,AAACkC,AAAe9B,AACC,AAACyC,AAAaxC,AACA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAC2C,AAA8B3C,AACAc,AACAZ,AACA,AAAA,AAAW0C,AACXzF,AAC7C,AAAA,AAAC0E,AAAe,AAACQ,AAAc,AAACZ,AAAuBvB,AACtC,AAAA,AAACsC,AAAazC,AACd,AAAA,AAACyC,AAAa1C,AACd,AAAA,AAACwC,AAAkBvB;AAvB1D,AAwBEjD;;AACF,AAACsE,AACA;AAAA,AACE,AAAA,AAACP,AAAe,AAACN,AAAc,AAACc,AAActC,AACf,AAAA,AAAAY,AAAA,AAAA,AAAKpB,AACL,AAAA,AAAA,AAAI,AAAA,AAAAoB,AAAIlC,AAAOW,AAC7B,AAACqD,AAAoBvC,AACrB,AAACsC,AAAa3B,AAAgB,AAAA,AAAML,AACpC,AAAA,AAACgC,AAAa1C;AAPlC,AAAA,AAAAa,AAAA,AAAAA,AAQGlC,AAAQc;;AAEX,AAACsD,AACA;AAAA,AACE,AAAM1E;AAAN,AACE,AAAC8C;;AADH;;AADF,AAAAN,AAGGpB;;;AACJ,AAACuD,AACA;AAAA,AACE,AACE7E;AACA,AACE,AAAC8E;;AACD,AAAC/B,AAAOzB,AAAQtB;;AAJpB,AAAA,AAAA0C,AAMGpB;AACD,AAAC0B;;AAPH;;;AAFH,AAUEhD;;AACF,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA+E,AAACC,AACCC,AACiBC,AAEhBC,AACA,AAAA,AAAA,AAACC,AAAgBnF,AACVkC,AACNkD,AACQ,AAACD,AAAM,AAACE,AACD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAMC,AACexB,AACA,AAAA,AAAA,AAAArB,AAAY8C,AACjDH,AACQ,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACD,AAAM,AAACK,AAAyB/E,AACA,AAAI,AAAC0C,AAAEb,AAAalB,AAClB,AAACqE,AAAajC,AACA1C,AACd0C,AACF,AAAA,AAAG/C,AAC3CiF,AACA,AAAA,AAAA,AAAA,AAAA,AAACP,AAAM/C,AACW9B,AACAF,AACA,AAACuF,AAAI9F,AACtBuF,AAAsBQ,AACtB,AAAA,AAAA,AAAA,AAAA,AAAA,AAAM9F,AACHkF,AAAgBa,AACpBH,AACA,AAAA,AAAA,AAAA,AAAA,AAACP,AAAM9C,AACWjC,AACAE,AACA,AAAK,AAACqF,AAAI9F,AACL,AAACiG,AAAKxD,AAAalB,AACzCgE,AACS9C,AAER8C,AAC6BjE,AACA,AAAGA,AACA,AAAI,AAAA,AAAKmE,AAAc3E,AACrBC,AACA,AAAA,AAASI;AAzCjD,AA0CmB,AAAC8B,AAAOvC,AAAO,AAAAuE;AAC5B,AAAA,AAAA,AAACiB,AACK,AAACC,AAAmB9F;;AAEpC,AAAK+F,AAAa,AAACC,AAA0B,AAACC,AAAWhH","names":["quo.components.bottom-sheet.view/opacity-coeff","quo.components.bottom-sheet.view/close-duration","quo.components.bottom-sheet.view/spring-config","quo.components.bottom-sheet.view/bottom-sheet-hooks","props","map__18688","cljs.core/PROTOCOL_SENTINEL","cljs.core/apply","cljs.core/hash-map","cljs.core/get","map__18689","map__18690","on-cancel","disable-drag?","show-handle?","visible?","backdrop-dismiss?","back-button-cancel","children","cljs-bean.core/bean","body-ref","quo.react/create-ref","master-ref","height","quo.react/state","window-height","quo.react-native/use-window-dimensions","keyboard-shown","keyboard-height","quo.react-native/use-keyboard","keyboard-height-android-delta","quo.platform/android?","safe-area","react-native.safe-area/get-insets","min-height","quo.components.bottom-sheet.style/vertical-padding","max-height","visible","master-translation-y","quo.animated/use-value","master-velocity-y","quo.gesture-handler/states","master-state","tap-state","manual-open","manual-close","offset","drag-over","clock","quo.animated/use-clock","tap-gesture-handler","quo.animated/use-gesture","on-master-event","on-body-event","sheet-height","x__4217__auto__","y__4218__auto__","cljs.core/deref","quo.components.bottom-sheet.style/border-radius","open-snap-point","close-snap-point","on-close","cljs.core/reset!","close-sheet","quo.animated/set-value","on-snap","pos","cljs.core/=","interrupted","quo.animated/and*","quo.animated/eq","quo.animated/clock-running","translate-y","quo.react/use-memo","quo.animated/with-easing","quo.animated/cond*","quo.animated/less-or-eq","quo.animated/divide","opacity","quo.animated/interpolate","quo.animated/multiply","quo.animated/extrapolate","quo.animated/code!","quo.animated/not*","quo.animated/call*","quo.animated/block","quo.animated/set","quo.animated/stop-clock","quo.animated/re-spring","quo.animated/re-timing","quo.animated/easings","quo.react-native/use-back-handler","quo.react/effect!","quo.react-native/dismiss-keyboard!","p1__18683#","reagent.core/as-element","quo.react-native/view","quo.components.bottom-sheet.style/container","quo.gesture-handler/tap-gesture-handler","cljs.core/merge","quo.animated/view","quo.components.bottom-sheet.style/backdrop","quo.platform/ios?","quo.design-system.colors/theme","quo.components.bottom-sheet.style/content-container","quo.animated/add","quo.gesture-handler/pan-gesture-handler","cljs.core/not","quo.components.bottom-sheet.style/content-header","quo.components.bottom-sheet.style/handle","cljs.core/not=","cljs.core/into","quo.react/get-children","quo.components.bottom-sheet.view/bottom-sheet","reagent.core/adapt-react-class","quo.react/memo"],"sourcesContent":["(ns quo.components.bottom-sheet.view\n  (:require [cljs-bean.core :as bean]\n            [quo.animated :as animated]\n            [quo.components.bottom-sheet.style :as styles]\n            [quo.design-system.colors :as colors]\n            [quo.gesture-handler :as gesture-handler]\n            [quo.platform :as platform]\n            [quo.react :as react]\n            [quo.react-native :as rn]\n            [reagent.core :as reagent]\n            [react-native.safe-area :as safe-area]))\n\n(def opacity-coeff 0.8)\n(def close-duration 150)\n(def spring-config\n  {:damping                   15\n   :mass                      0.7\n   :stiffness                 150\n   :overshootClamping         false\n   :restSpeedThreshold        0.1\n   :restDisplacementThreshold 0.1})\n\n(defn bottom-sheet-hooks\n  [props]\n  (let [{on-cancel          :onCancel\n         disable-drag?      :disableDrag?\n         show-handle?       :showHandle?\n         visible?           :visible?\n         backdrop-dismiss?  :backdropDismiss?\n         back-button-cancel :backButtonCancel\n         children           :children\n         :or                {show-handle?       true\n                             backdrop-dismiss?  true\n                             back-button-cancel true}}\n        (bean/bean props)\n        body-ref (react/create-ref)\n        master-ref (react/create-ref)\n\n        height (react/state 0)\n        {window-height :height} (rn/use-window-dimensions)\n        {:keys [keyboard-shown\n                keyboard-height]}\n        (rn/use-keyboard)\n        keyboard-height-android-delta\n        (if (and platform/android? keyboard-shown) (+ keyboard-height 20) 0)\n        safe-area (safe-area/get-insets)\n        window-height (- window-height\n                         (if platform/android?\n                           (+ 50 keyboard-height-android-delta) ;; TODO : remove 50 when\n                                                                ;; react-native-navigation v8 will be\n                                                                ;; implemented\n                                                                ;; https://github.com/wix/react-native-navigation/issues/7225\n                           0))\n        min-height (+ (* styles/vertical-padding 2) (:bottom safe-area))\n        max-height (- window-height (:top safe-area))\n        visible (react/state false)\n\n        master-translation-y (animated/use-value 0)\n        master-velocity-y (animated/use-value (:undetermined gesture-handler/states))\n        master-state (animated/use-value (:undetermined gesture-handler/states))\n        tap-state (animated/use-value 0)\n        manual-open (animated/use-value 0)\n        manual-close (animated/use-value 0)\n        offset (animated/use-value 0)\n        drag-over (animated/use-value 1)\n        clock (animated/use-clock)\n        tap-gesture-handler (animated/use-gesture {:state tap-state})\n        on-master-event (animated/use-gesture\n                         {:translationY master-translation-y\n                          :state        master-state\n                          :velocityY    master-velocity-y})\n        on-body-event on-master-event\n        sheet-height (min max-height\n                          (+ styles/border-radius @height))\n\n        open-snap-point (animated/use-value 0)\n        close-snap-point 0\n        on-close (fn []\n                   (when @visible\n                     (reset! visible false)\n                     (reset! height 0)\n                     (when on-cancel\n                       (on-cancel))))\n        close-sheet (fn []\n                      (animated/set-value manual-close 1))\n        on-snap (fn [pos]\n                  (when (= close-snap-point (aget pos 0))\n                    (on-close)))\n        interrupted (animated/and* (animated/eq master-state (:began gesture-handler/states))\n                                   (animated/clock-running clock))\n        translate-y (react/use-memo\n                     (fn []\n                       (animated/with-easing\n                        {:value          (animated/cond* (animated/less-or-eq master-translation-y 0)\n                                                         (animated/divide master-translation-y 2)\n                                                         master-translation-y)\n                         :velocity       master-velocity-y\n                         :offset         offset\n                         :state          master-state\n                         :animation-over drag-over\n                         :snap-points    [open-snap-point close-snap-point]}))\n                     [])\n        opacity (react/use-memo\n                 (fn []\n                   (animated/cond*\n                    open-snap-point\n                    (animated/interpolate\n                     translate-y\n                     {:inputRange  [(animated/multiply open-snap-point opacity-coeff) 0]\n                      :outputRange [1 0]\n                      :extrapolate (:clamp animated/extrapolate)})))\n                 [])]\n    (animated/code!\n     (fn []\n       (animated/cond* (animated/and* (animated/eq master-state (:end gesture-handler/states))\n                                      (animated/not* drag-over))\n                       (animated/call* [translate-y] on-snap)))\n     [on-snap])\n    (animated/code!\n     (fn []\n       (animated/block\n        [(animated/cond* (animated/and* interrupted manual-open)\n                         [(animated/set manual-open 0)\n                          (animated/set offset open-snap-point)\n                          (animated/stop-clock clock)])\n         (animated/cond* (animated/and* manual-open\n                                        (animated/not* manual-close))\n                         [(animated/set offset\n                                        (animated/re-spring {:from   offset\n                                                             :to     open-snap-point\n                                                             :clock  clock\n                                                             :config spring-config}))\n                          (animated/cond* (animated/not* (animated/clock-running clock))\n                                          (animated/set manual-open 0))])]))\n     [])\n    (animated/code!\n     (fn []\n       (animated/block\n        [(animated/cond* (animated/and* interrupted manual-close)\n                         [(animated/set manual-close 0)\n                          (animated/set offset close-snap-point)\n                          (animated/call* [] on-close)\n                          (animated/stop-clock clock)])\n         (animated/cond* (animated/eq tap-state (:end gesture-handler/states))\n                         [(animated/cond* (animated/and* (animated/not* manual-close))\n                                          [(animated/stop-clock clock)\n                                           (animated/set manual-close 1)])\n                          (animated/set tap-state (:undetermined gesture-handler/states))])\n         (animated/cond* manual-close\n                         [(animated/set offset\n                                        (animated/re-timing {:from     offset\n                                                             :to       close-snap-point\n                                                             :clock    clock\n                                                             :easing   (:ease-out animated/easings)\n                                                             :duration close-duration}))\n                          (animated/cond* (animated/not* (animated/clock-running clock))\n                                          [(animated/set manual-close 0)\n                                           (animated/set manual-open 0)\n                                           (animated/call* [] on-close)])])]))\n     [on-cancel])\n    (animated/code!\n     (fn []\n       (animated/cond* (animated/and* (animated/not* manual-close)\n                                      (if @visible 1 0)\n                                      (if (> @height min-height) 1 0))\n                       [(animated/stop-clock clock)\n                        (animated/set open-snap-point (* -1 sheet-height))\n                        (animated/set manual-open 1)]))\n     [@height @visible])\n    ;; NOTE(Ferossgp): Remove me when RNGH will suport modal\n    (rn/use-back-handler\n     (fn []\n       (when back-button-cancel\n         (close-sheet))\n       @visible))\n    (react/effect!\n     (fn []\n       (cond\n         visible?\n         (do\n           (rn/dismiss-keyboard!)\n           (reset! visible visible?))\n\n         @visible\n         (close-sheet)))\n     [visible?])\n    (reagent/as-element\n     [rn/view\n      {:style          styles/container\n       :pointer-events :box-none}\n      [gesture-handler/tap-gesture-handler\n       (merge {:enabled backdrop-dismiss?}\n              tap-gesture-handler)\n       [animated/view\n        {:style (merge (styles/backdrop)\n                       (when platform/ios?\n                         {:opacity          opacity\n                          :background-color (:backdrop @colors/theme)}))}]]\n      [animated/view\n       {:style (merge (styles/content-container window-height)\n                      {:transform [{:translateY (if (= sheet-height max-height)\n                                                  (animated/add translate-y\n                                                                keyboard-height-android-delta)\n                                                  translate-y)}\n                                   {:translateY (* window-height 2)}]})}\n       [gesture-handler/pan-gesture-handler\n        (merge on-master-event\n               {:ref      master-ref\n                :wait-for body-ref\n                :enabled  (not disable-drag?)})\n        [animated/view {:style styles/content-header}\n         (when show-handle?\n           [rn/view {:style styles/handle}])]]\n       [gesture-handler/pan-gesture-handler\n        (merge on-body-event\n               {:ref      body-ref\n                :wait-for master-ref\n                :enabled  (and (not disable-drag?)\n                               (not= sheet-height max-height))})\n        [animated/view\n         {:height sheet-height\n          :flex   1}\n         [animated/view\n          {:style     {:padding-top    styles/vertical-padding\n                       :padding-bottom (+ styles/vertical-padding\n                                          (if (and platform/ios? keyboard-shown)\n                                            keyboard-height\n                                            (:bottom safe-area)))}\n           :on-layout #(reset! height (.-nativeEvent.layout.height ^js %))}\n          (into [:<>]\n                (react/get-children children))]]]]])))\n\n(def bottom-sheet (reagent/adapt-react-class (react/memo bottom-sheet-hooks)))\n"]}